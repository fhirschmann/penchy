#!/usr/bin/env python

"""
This program can be used to test a job locally without
the involvement of a server and nodes.
"""

import sys
import logging
import os

import argparse

from penchy.client import Client
from penchy.util import load_config, load_job


if __name__ == "__main__":
        parser = argparse.ArgumentParser(description=__doc__)
        log_group = parser.add_mutually_exclusive_group()
        log_group.add_argument("-d", "--debug",
                action="store_const", const=logging.DEBUG,
                dest="loglevel", default=logging.INFO,
                help="print debugging messages")
        log_group.add_argument("-q", "--quiet",
                action="store_const", const=logging.WARNING,
                dest="loglevel", help="suppress most messages")
        parser.add_argument("-c", "--config",
                action="store", dest="config",
                default=os.path.expanduser("~/.penchyrc"),
                help="config module to use")
        parser.add_argument("job", help="job to execute",
                metavar="job")
        args = parser.parse_args()
        logging.root.setLevel(args.loglevel)

        config = load_config(args.config)
        job = load_job(args.job, config)

        for configuration in job.job.configurations_for_node(self.identifier):
            job.job.run(configuration)
